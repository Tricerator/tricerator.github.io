<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Dungeon Runner ‚Äì ≈°koln√≠ verze</title>
  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: radial-gradient(circle at top, #222 0, #050608 60%);
      color: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    h1 {
      margin-top: 20px;
      letter-spacing: 2px;
      text-transform: uppercase;
      text-align: center;
    }

    #menu, #game {
      max-width: 900px;
      width: 100%;
      padding: 20px;
      box-sizing: border-box;
    }

    #menu {
      margin-top: 20px;
      background: rgba(0, 0, 0, 0.7);
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.7);
    }

    label {
      display: block;
      margin: 10px 0 4px;
      font-weight: 600;
    }

    select, button {
      font-size: 16px;
      padding: 8px 10px;
      border-radius: 6px;
      border: none;
      margin-bottom: 10px;
    }

    button {
      cursor: pointer;
      font-weight: 700;
    }

    button#startGame {
      margin-top: 10px;
      background: #4caf50;
      color: white;
    }

    button#startGame:hover {
      filter: brightness(1.1);
    }

    .hidden {
      display: none;
    }

    #hud {
      display: flex;
      justify-content: space-between;
      gap: 15px;
      flex-wrap: wrap;
      font-size: 14px;
      background: rgba(0, 0, 0, 0.8);
      padding: 10px 15px;
      border-radius: 10px;
      margin-bottom: 10px;
    }

    #hud span {
      white-space: nowrap;
    }

    #controls {
      font-size: 14px;
      margin-bottom: 10px;
      background: rgba(0,0,0,0.6);
      padding: 8px 12px;
      border-radius: 8px;
    }

    #mainRow {
      display: flex;
      gap: 12px;
      align-items: flex-start;
    }

    #grid {
      display: grid;
      grid-template-columns: repeat(10, 40px);
      grid-template-rows: repeat(10, 40px);
      gap: 3px;
      margin-top: 10px;
      background: #111;
      padding: 6px;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.7);
    }

    .tile {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      background: #1c1c1c;
      font-size: 22px;
      user-select: none;
    }

    .tile.player {
      background: #264653;
    }

    .tile.monster {
      background: #8d2b2b;
    }

    .tile.chest {
      background: #8c6b2f;
    }

    .tile.exit {
      background: #205c20;
    }

    .tile.wall {
      background: #444;
    }

    .tile.empty {
      background: #181818;
      color: #444;
      font-size: 14px;
    }

    #sideColumn {
      display: flex;
      flex-direction: column;
      gap: 8px;
      flex: 1;
    }

    #log {
      max-height: 180px;
      overflow-y: auto;
      font-size: 13px;
      background: rgba(0,0,0,0.7);
      padding: 8px 12px;
      border-radius: 8px;
    }

    #log p {
      margin: 2px 0;
    }

    #inventory {
      font-size: 13px;
      background: rgba(0,0,0,0.6);
      padding: 8px 12px;
      border-radius: 8px;
      max-height: 140px;
      overflow-y: auto;
    }

    #inventory h3 {
      margin: 0 0 4px;
      font-size: 14px;
    }

    #inventory ul {
      margin: 0;
      padding-left: 16px;
    }

    #inventory li {
      margin-bottom: 2px;
    }

    #gameOverOverlay,
    #shopOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      color: white;
      z-index: 10;
      text-align: center;
      padding: 20px;
      box-sizing: border-box;
    }

    #gameOverOverlay button,
    #shopOverlay button {
      margin-top: 10px;
      background: #4caf50;
      color: white;
    }

    #shopItems {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin: 12px 0;
      max-width: 300px;
      width: 100%;
    }

    #shopItems button {
      width: 100%;
      background: #333;
    }
  </style>
</head>
<body>
  <h1>Dungeon Runner ‚Äì ≈°koln√≠ verze</h1>

  <!-- MENU: volba rasy+t≈ô√≠dy v jednom -->
  <section id="menu">
    <p>Jednoduch√Ω dungeon, kde si ≈æ√°ci procviƒç√≠ ovl√°d√°n√≠ kl√°vesnice (WASD, ≈°ipky, mezern√≠k, ƒç√≠sla).</p>

    <label for="raceSelect">Postava</label>
    <select id="raceSelect">
      <option value="human">ƒålovƒõk ‚Äì M√°g (mana, √∫tok na d√°lku)</option>
      <option value="elf">Elf ‚Äì Luƒçi≈°tn√≠k (≈°√≠py, √∫tok na d√°lku)</option>
      <option value="dwarf">Trpasl√≠k ‚Äì V√°leƒçn√≠k (lep≈°√≠ zbroj)</option>
      <option value="hobbit">Hobit ‚Äì Zlodƒõj (v√≠c zlata z lupu)</option>
    </select>

    <button id="startGame">Start hry</button>
  </section>

  <!-- HRA -->
  <section id="game" class="hidden">
    <div id="hud">
      <span id="hudLevel"></span>
      <span id="hudClassRace"></span>
      <span id="hudHp"></span>
      <span id="hudAttack"></span>
      <span id="hudWeapon"></span>
      <span id="hudGold"></span>
      <span id="hudResource"></span>
      <span id="hudKeys"></span>
    </div>

    <div id="controls">
      <strong>Ovl√°d√°n√≠:</strong>
      Pohyb: WASD nebo ≈°ipky | Bl√≠zk√Ω √∫tok: mezern√≠k (na sousedn√≠ monstrum) | Ability 1: kl√°vesa 1 (mal√© l√©ƒçen√≠) |  
      √ötok na d√°lku: kl√°vesa 2 ‚Äì <em>ƒålovƒõk (m√°g)</em> = kouzlo (mana), <em>Elf (luƒçi≈°tn√≠k)</em> = ≈°√≠py.  
      Ranged √∫tok automaticky c√≠l√≠ na nejbli≈æ≈°√≠ho nep≈ô√≠tele v ≈ôadƒõ/ sloupci ve vzd√°lenosti 2‚Äì4 pol√≠.  
      C√≠l: zabij v≈°echna monstra, posb√≠rej zlato a dojdi ke dve≈ô√≠m üö™. Dve≈ôe se otev≈ôou a≈æ po vyƒçi≈°tƒõn√≠ dungeonu.
    </div>

    <div id="mainRow">
      <div id="grid"></div>
      <div id="sideColumn">
        <div id="log"></div>
        <div id="inventory">
          <h3>Invent√°≈ô</h3>
          <ul id="inventoryList"></ul>
        </div>
      </div>
    </div>
  </section>

  <!-- Game over -->
  <div id="gameOverOverlay">
    <h2 id="gameOverText"></h2>
    <button id="restartBtn">Hr√°t znovu</button>
  </div>

  <!-- Obchod po levelu -->
  <div id="shopOverlay">
    <h2>Obchod mezi levely</h2>
    <p id="shopInfo"></p>
    <div id="shopItems">
      <button data-action="hp"></button>
      <button data-action="atk"></button>
      <button data-action="def"></button>
      <button data-action="heal"></button>
    </div>
    <button id="nextLevelBtn">Dal≈°√≠ level ‚ñ∂</button>
  </div>

  <script>
    // ==== Hern√≠ stav ====
    const mapWidth = 10;
    const mapHeight = 10;

    const MONSTER_TYPES = [
      { name: 'Sliz',       hp: 10, attack: 3, symbol: 'üëæ' },
      { name: 'Kostlivec',  hp: 12, attack: 4, symbol: 'üíÄ' },
      { name: 'Netvor',     hp: 16, attack: 5, symbol: 'üëπ' }
    ];

    const THIEF_GOLD_MULTIPLIER = 1.6; // hobit ‚Äì v√≠c zlata

    const player = {
      x: 0,
      y: 9,
      maxHp: 1,
      hp: 1,
      baseAttack: 1,
      defense: 0,
      weaponBonus: 0,
      raceName: "",
      archetype: "",       // M√°g / Luƒçi≈°tn√≠k / V√°leƒçn√≠k / Zlodƒõj
      maxMana: 0,
      mana: 0,
      arrows: 0,
      facing: { dx: 1, dy: 0 },
      symbol: 'üßô',
      isThief: false,
      items: []
    };

    let monsters = [];
    let chests = [];
    let walls = [];
    const exit = { x: 9, y: 0 }; // v√Ωchod
    let keyPressCount = 0;
    let gameRunning = false;
    let level = 1;
    let gold = 0;

    // vizu√°ln√≠ projektil
    let projectilePath = [];
    let projectileType = null; // "spell" nebo "arrow"

    const hudLevel   = document.getElementById('hudLevel');
    const hudClassRace = document.getElementById('hudClassRace');
    const hudHp      = document.getElementById('hudHp');
    const hudAttack  = document.getElementById('hudAttack');
    const hudWeapon  = document.getElementById('hudWeapon');
    const hudGold    = document.getElementById('hudGold');
    const hudResource = document.getElementById('hudResource');
    const hudKeys    = document.getElementById('hudKeys');
    const gridEl     = document.getElementById('grid');
    const logEl      = document.getElementById('log');
    const inventoryListEl = document.getElementById('inventoryList');
    const menuEl     = document.getElementById('menu');
    const gameEl     = document.getElementById('game');
    const gameOverOverlay = document.getElementById('gameOverOverlay');
    const gameOverText    = document.getElementById('gameOverText');

    const shopOverlay = document.getElementById('shopOverlay');
    const shopInfo    = document.getElementById('shopInfo');
    const shopItems   = document.getElementById('shopItems');
    const nextLevelBtn = document.getElementById('nextLevelBtn');

    // ==== Obchod ‚Äì inflace cen ====
    const SHOP_INFLATION = 1.4;
    const shopCosts = {
      hp: 10,
      atk: 10,
      def: 8,
      heal: 6
    };

    function updateShopButtons() {
      shopItems.querySelectorAll('button').forEach(btn => {
        const action = btn.dataset.action;
        if (action === 'hp') {
          btn.textContent = `+5 max HP (${shopCosts.hp} zlata)`;
        } else if (action === 'atk') {
          btn.textContent = `+2 z√°kladn√≠ √∫tok (${shopCosts.atk} zlata)`;
        } else if (action === 'def') {
          btn.textContent = `+1 obrana (${shopCosts.def} zlata)`;
        } else if (action === 'heal') {
          btn.textContent = `Vyl√©ƒçit na pln√© HP (${shopCosts.heal} zlata)`;
        }
      });
    }

    // ==== Pomocn√© funkce ====
    function log(msg) {
      const p = document.createElement('p');
      p.textContent = msg;
      logEl.appendChild(p);
      logEl.scrollTop = logEl.scrollHeight;
    }

    function updateInventory() {
      inventoryListEl.innerHTML = "";
      player.items.forEach(item => {
        const li = document.createElement('li');
