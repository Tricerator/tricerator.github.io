<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Jednoduch√° hra ‚Äì Ovoce</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #f0f0f0;
    }

    #hud {
        padding: 10px;
        background: #333;
        color: white;
        font-size: 18px;
        line-height: 1.4;
    }

    #gameArea {
        position: relative;
        width: 100vw;
        height: calc(100vh - 70px);
        background: #eee;
        overflow: hidden;
        cursor: crosshair;
    }

    .square {
        position: absolute;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 0, 0, 0.05); /* jemn√Ω hitbox */
        user-select: none;
    }

    /* LEVEL / GAME OVER OVERLAY */
    #levelOverlay {
        position: fixed;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0,0,0,0.85);
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 48px;
        font-weight: bold;
        z-index: 9999;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s linear;
    }

    #levelOverlay.visible {
        opacity: 1;
        pointer-events: auto;
    }

    #levelText {
        text-align: center;
        padding: 20px;
        animation: none;
    }

    /* Animace textu v overlayi */
    #levelOverlay.visible #levelText {
        animation: popIn 1.0s ease-out;
    }

    @keyframes popIn {
        0%   { transform: scale(0.5); opacity: 0; }
        50%  { transform: scale(1.2); opacity: 1; }
        100% { transform: scale(1.0); opacity: 1; }
    }

    /* Trochu men≈°√≠ text HUD na √∫zk√Ωch displej√≠ch */
    @media (max-width: 768px) {
        #hud {
            font-size: 14px;
        }
    }
</style>
</head>
<body>

<div id="hud">
    ‚è± ƒåas: <span id="time">0.0</span> s  
    | üéØ Z√°sahy: <span id="hit">0</span>/<span id="total">0</span>
    | üî• √örove≈à: <span id="level">1</span> (ka≈æd√Ωch 10 z√°sah≈Ø)
    | üíó ≈Ωivoty: <span id="lives">10</span>
    <br>
    ‚≠ê Sk√≥re: <span id="score">0</span>
    | ‚ö° Combo: <span id="combo">0</span> (max: <span id="bestCombo">0</span>)
    <br>
    P = pauza (PC), dvoj≈•uk/dvouprst√Ω tap = pauza (mobil)
</div>

<div id="gameArea"></div>

<div id="levelOverlay">
    <div id="levelText"></div>
</div>

<!-- Zvuky (voliteln√© ‚Äì m≈Ø≈æe≈° nahradit nebo smazat) -->
<audio id="hitSound" src="hit.wav" preload="auto"></audio>
<audio id="missSound" src="miss.wav" preload="auto"></audio>

<script>
let gameRunning           = false;
let waitingForLevelStart  = false;
let gameOver              = false;

let time   = 0;
let hit    = 0;
let total  = 0;
let level  = 1;

// NOV√â: sk√≥re a ≈æivoty
let score      = 0;
let combo      = 0;
let bestCombo  = 0;
const maxLives = 10;
let lives      = maxLives;

let timerInterval = null;
let spawnInterval = null;

// po kolika z√°saz√≠ch se zvedne level
const HITS_PER_LEVEL = 10;

// z√°kladn√≠ parametry obt√≠≈ænosti ‚Äì POMALEJ≈†√ç START
let baseSpawnDelay = 1200;   // ms (d≈ô√≠ve 800)
let baseLifetime   = 3000;   // ms (d≈ô√≠ve 2000)
let baseSquareSize = 80;     // px

const minSpawnDelay = 250;
const minLifetime   = 500;
const minSquareSize = 20;

// detekce "mal√© obrazovky"
const isSmallScreen = window.innerWidth < 768;

// pro mal√© displeje to trochu zlehƒç√≠me
if (isSmallScreen) {
    baseSquareSize = 100;
    baseLifetime   = 3200;
}

let spawnDelay = baseSpawnDelay;
let lifetime   = baseLifetime;
let squareSize = baseSquareSize;

// bezpeƒçn√° z√≥na dole na mobilu (aby ovoce nebylo u syst√©mov√Ωch tlaƒç√≠tek)
const bottomSafeZone = isSmallScreen ? 80 : 0;
const topSafeZone    = isSmallScreen ? 30 : 0;

const timeEl      = document.getElementById("time");
const hitEl       = document.getElementById("hit");
const totalEl     = document.getElementById("total");
const levelEl     = document.getElementById("level");
const livesEl     = document.getElementById("lives");
const scoreEl     = document.getElementById("score");
const comboEl     = document.getElementById("combo");
const bestComboEl = document.getElementById("bestCombo");
const gameArea    = document.getElementById("gameArea");

const levelOverlay = document.getElementById("levelOverlay");
const levelText    = document.getElementById("levelText");

const hitSound  = document.getElementById("hitSound");
const missSound = document.getElementById("missSound");

// Ovoce pro levely ‚Äì po≈ôad√≠: 1 = T≈òE≈†E≈á
const levelFruitEmojis = ["üçí","üçé","üçá","üçì","üçå","üçç","üçâ","ü•ù"];
const levelFruitNames  = ["T≈ôe≈°e≈à","Jablko","Hrozny","Jahoda","Ban√°n","Ananas","Meloun","Kiwi"];

function getFruitEmojiForLevel(l) {
    const idx = (l - 1) % levelFruitEmojis.length;
    return levelFruitEmojis[idx];
}

function getFruitNameForLevel(l) {
    const idx = (l - 1) % levelFruitNames.length;
    return levelFruitNames[idx];
}

// ---- ƒåASOM√çRA ----
function startTimer() {
    if (timerInterval) return;
    timerInterval = setInterval(() => {
        time += 0.1;
        timeEl.textContent = time.toFixed(1);
    }, 100);
}

function stopTimer() {
    clearInterval(timerInterval);
    timerInterval = null;
}

// ---- ZVUKY ----
function playSound(sound) {
    if (!sound) return;
    try {
        sound.currentTime = 0;
        sound.play();
    } catch (e) {
        // autoplay blok ‚Äì ignorujeme
    }
}

// ---- OBT√ç≈ΩNOST PODLE LEVELU ----
function applyDifficultyForLevel() {
    const l = Math.max(1, level);

    // postupnƒõ rychlej≈°√≠ a krat≈°√≠ ƒças zobrazen√≠
    spawnDelay = Math.max(minSpawnDelay, baseSpawnDelay - (l - 1) * 70);
    lifetime   = Math.max(minLifetime,   baseLifetime   - (l - 1) * 160);
    squareSize = Math.max(minSquareSize, baseSquareSize - (l - 1) * 6);

    // kdy≈æ se zmƒõn√≠ obt√≠≈ænost, p≈ôenastav√≠me interval
    if (spawnInterval) {
        startSpawning(); // restart s nov√Ωm spawnDelay
    }
}

// ---- LEVEL / GAME OVER OVERLAY ----
function showLevelOverlay(levelNumber) {
    const emoji = getFruitEmojiForLevel(levelNumber);
    const name  = getFruitNameForLevel(levelNumber);

    let extra = "";
    if (levelNumber === 1) {
        extra = "<br><span style='font-size:0.4em;'>C√≠l: nasb√≠rej " + HITS_PER_LEVEL +
                " t≈ôe≈°n√≠. M√°≈° " + maxLives + " ≈æivot≈Ø.</span>";
    } else {
        extra = "<br><span style='font-size:0.4em;'>Ovoce je o nƒõco men≈°√≠ a rychlej≈°√≠.</span>";
    }

    levelText.innerHTML =
        "LEVEL " + levelNumber + " ‚Äì " + emoji + " " + name +
        "<br><span style='font-size:0.6em;'>Klikni / ≈•ukni pro start</span>" +
        extra;

    clearAllSquares();

    gameRunning = false;
    stopTimer();
    stopSpawning();

    waitingForLevelStart = true;
    gameOver = false;
    levelOverlay.classList.add("visible");
}

function showGameOver() {
    gameRunning = false;
    waitingForLevelStart = false;
    gameOver = true;

    stopTimer();
    stopSpawning();
    clearAllSquares();

    levelText.innerHTML =
        "KONEC HRY" +
        "<br><span style='font-size:0.6em;'>Sk√≥re: " + score + "</span>" +
        "<br><span style='font-size:0.6em;'>Nejlep≈°√≠ combo: " + bestCombo + "</span>" +
        "<br><span style='font-size:0.6em;'>Z√°sahy: " + hit + "/" + total + "</span>" +
        "<br><br><span style='font-size:0.5em;'>Klikni / ≈•ukni pro novou hru</span>";

    levelOverlay.classList.add("visible");
}

function startLevelIfWaiting() {
    if (!waitingForLevelStart) return;

    waitingForLevelStart = false;
    levelOverlay.classList.remove("visible");

    gameRunning = true;
    startTimer();
    startSpawning();
}

function resetGame() {
    time  = 0;
    hit   = 0;
    total = 0;
    level = 1;
    score = 0;
    combo = 0;
    bestCombo = 0;
    lives = maxLives;

    timeEl.textContent      = "0.0";
    hitEl.textContent       = "0";
    totalEl.textContent     = "0";
    levelEl.textContent     = level;
    scoreEl.textContent     = score;
    comboEl.textContent     = combo;
    bestComboEl.textContent = bestCombo;
    livesEl.textContent     = lives;

    applyDifficultyForLevel();
    showLevelOverlay(level);
}

// klik / ≈•uk na overlay
levelOverlay.addEventListener("pointerdown", () => {
    if (gameOver) {
        // Nov√° hra
        resetGame();
        // Hned spust√≠me level 1
        startLevelIfWaiting();
    } else {
        startLevelIfWaiting();
    }
});

// ---- PAUZA ----
function togglePause() {
    if (waitingForLevelStart || gameOver) return; // v overlay pauzu ne≈ôe≈°√≠me

    if (gameRunning) {
        gameRunning = false;
        stopTimer();
        // spawnInterval nech√°me bƒõ≈æet, ale spawnSquare nebude tvo≈ôit ovoce,
        // proto≈æe gameRunning=false (viz startSpawning)
    } else {
        gameRunning = true;
        startTimer();
    }
}

// PC: P = pauza
document.addEventListener("keydown", e => {
    if (e.key.toLowerCase() === "p") {
        togglePause();
    }
});

// Mobil: dvoj≈•uk do hrac√≠ plochy = pauza
let lastTapTime = 0;

function handleTapPause() {
    const now = Date.now();
    if (now - lastTapTime < 300) { // druh√Ω tap do 300 ms
        togglePause();
        lastTapTime = 0;
    } else {
        lastTapTime = now;
    }
}

// Mobil: dvouprst√Ω tap (dvƒõma prsty najednou) = pauza
if (isSmallScreen) {
    window.addEventListener("touchstart", e => {
        if (e.touches.length >= 2) {
            e.preventDefault();
            togglePause();
        }
    }, { passive: false });
}

// ---- SK√ìRE / ≈ΩIVOTY ----
function updateComboDisplay() {
    comboEl.textContent = combo;
    bestComboEl.textContent = bestCombo;
}

function registerHit() {
    hit++;
    hitEl.textContent = hit;

    combo++;
    if (combo > bestCombo) {
        bestCombo = combo;
    }
    updateComboDisplay();

    score += 10 * combo; // ƒç√≠m del≈°√≠ s√©rie, t√≠m v√≠c bod≈Ø
    scoreEl.textContent = score;

    playSound(hitSound);
    checkLevelUp();
}

function registerMiss() {
    // aby se p≈ôi pauze / overlayi nestrh√°valy ≈æivoty
    if (!gameRunning || gameOver) return;

    combo = 0;
    updateComboDisplay();

    if (lives > 0) {
        lives--;
        livesEl.textContent = lives;
        playSound(missSound);
        if (lives <= 0) {
            showGameOver();
        }
    }
}

// ---- KONTROLA LEVELU PODLE SK√ìRE ----
function checkLevelUp() {
    const newLevel = Math.floor(hit / HITS_PER_LEVEL) + 1;
    if (newLevel > level) {
        level = newLevel;
        levelEl.textContent = level;
        applyDifficultyForLevel();
        showLevelOverlay(level);
    }
}

// ---- GENEROV√ÅN√ç OVOCE ----
function spawnSquare() {
    // interval teƒè bƒõ≈æ√≠ st√°le, ale ovoce se opravdu generuje jen,
    // kdy≈æ hra bƒõ≈æ√≠ a nen√≠ game over
    if (!gameRunning || gameOver) return;

    const square = document.createElement("div");
    square.className = "square";

    square.style.width  = squareSize + "px";
    square.style.height = squareSize + "px";
    square.style.fontSize = (squareSize * 0.6) + "px";

    // Ovoce odpov√≠d√° aktu√°ln√≠mu levelu ‚Äì JEN tohle jedno ovoce:
    square.textContent = getFruitEmojiForLevel(level);

    const areaW = gameArea.clientWidth  - squareSize;
    const maxH  = gameArea.clientHeight - squareSize - bottomSafeZone;
    const minY  = topSafeZone;
    const areaH = Math.max(0, maxH - minY);

    const x = Math.random() * Math.max(areaW, 0);
    const y = minY + (areaH > 0 ? Math.random() * areaH : 0);

    square.style.left = x + "px";
    square.style.top  = y + "px";

    total++;
    totalEl.textContent = total;

    let hitRegistered = false;

    function onHit() {
        if (hitRegistered || !gameRunning || gameOver) return;
        hitRegistered = true;

        square.remove();
        registerHit();
    }

    // Desktop: p≈ôejet√≠ my≈°√≠ (pointerenter),
    // Mobil i PC: ≈•uknut√≠/klik (pointerdown).
    square.addEventListener("pointerenter", onHit);
    square.addEventListener("pointerdown", onHit);

    gameArea.appendChild(square);

    // Zmiz√≠ po ƒçase 'lifetime'
    setTimeout(() => {
        if (square.parentElement) {
            square.remove();
            registerMiss();
        }
    }, lifetime);
}

function startSpawning() {
    // v≈ædycky zru≈°√≠me star√Ω interval a zalo≈æ√≠me nov√Ω, aby respektoval spawnDelay
    if (spawnInterval) {
        clearInterval(spawnInterval);
    }
    spawnInterval = setInterval(() => {
        spawnSquare();
    }, spawnDelay);
}

function stopSpawning() {
    if (spawnInterval) {
        clearInterval(spawnInterval);
        spawnInterval = null;
    }
}

// odstran√≠ v≈°echny aktu√°ln√≠ ƒçtverce (nap≈ô. p≈ôi zmƒõnƒõ levelu)
function clearAllSquares() {
    const squares = document.querySelectorAll(".square");
    squares.forEach(s => s.remove());
}

// ---- Klik/tap do hern√≠ plochy ----
gameArea.addEventListener("pointerdown", e => {
    // Mobiln√≠ dvoj≈•uk pro pauzu
    if (isSmallScreen && e.pointerType === "touch") {
        handleTapPause();
    }

    // Start hry z pauzy (pokud zrovna neƒçek√°me na overlay ani nen√≠ game over)
    if (!gameRunning && !waitingForLevelStart && !gameOver) {
        gameRunning = true;
        startTimer();
        // spawnInterval u≈æ bƒõ≈æ√≠ ‚Äì staƒç√≠ jen povolit spawnSquare p≈ôes gameRunning=true
    }
});

// ---- START: level 1, overlay na zaƒç√°tku ----
applyDifficultyForLevel();
levelEl.textContent = level;
livesEl.textContent = lives;
scoreEl.textContent = score;
comboEl.textContent = combo;
bestComboEl.textContent = bestCombo;
showLevelOverlay(level);
</script>
</body>
</html>
